# LLD 模块完整性检查清单

本文档定义了 LLD 各模块的必填项和检查标准。

## Core 模块（必选）

Core 模块是 LLD 的核心，必须存在。

### 必填章节

| # | 章节 | 必填内容 | 缺失严重度 |
|---|------|----------|-----------|
| 1 | 模块/包结构 | 目录结构、依赖关系图 | P1 |
| 2 | 核心接口/类定义 | 接口签名、类图、DTO 定义 | P0 |
| 3 | 关键流程伪代码 | Happy Path + 异常分支 | P0 |
| 4 | 错误处理策略 | 错误分类、处理流程、重试策略 | P1 |
| 5 | 测试设计 | 测试策略、覆盖目标、Mock 方案 | P1 |

### 检查要点

**模块/包结构**：
- [ ] 是否有目录树结构？
- [ ] 是否说明了各包/模块的职责？
- [ ] 是否有依赖关系图（Mermaid）？
- [ ] 依赖方向是否合理（无循环依赖）？

**核心接口/类定义**：
- [ ] 核心接口是否有完整签名？
- [ ] 是否与 API Contract 映射？
- [ ] DTO 是否定义清晰？
- [ ] 是否有必要的类图？

**关键流程伪代码**：
- [ ] 是否覆盖主要 Happy Path？
- [ ] 是否覆盖关键异常分支？
- [ ] 伪代码是否可读？
- [ ] 是否有流程图配合？

**错误处理策略**：
- [ ] 错误是否分类？
- [ ] 每类错误是否有处理策略？
- [ ] 重试策略是否明确？
- [ ] 错误码是否与 Contract 一致？

**测试设计**：
- [ ] 测试策略是否明确（单测/集成/E2E）？
- [ ] 覆盖目标是否量化？
- [ ] Mock 方案是否可行？
- [ ] 测试数据方案是否明确？

---

## API Contract 模块

当 LLD 需要实现 API Contract 时启用。

### 必填章节

| # | 章节 | 必填内容 | 缺失严重度 |
|---|------|----------|-----------|
| 1 | 接口实现映射 | Contract 接口 → 实现类/方法映射 | P1 |
| 2 | 请求/响应转换 | DTO 转换逻辑 | P1 |
| 3 | 错误码映射 | Contract 错误码 → 内部异常映射 | P1 |

### 检查要点

- [ ] 是否列出所有需实现的 Contract 接口？
- [ ] 每个接口是否有对应的实现类/方法？
- [ ] 请求/响应 DTO 转换逻辑是否明确？
- [ ] 错误码映射是否完整且与 Contract 一致？

---

## Storage & Migration 模块

当 LLD 涉及数据存储或迁移时启用。

### 必填章节

| # | 章节 | 必填内容 | 缺失严重度 |
|---|------|----------|-----------|
| 1 | 数据模型详细设计 | 表结构/文档结构、字段定义 | P1 |
| 2 | 索引设计 | 索引列表、索引策略 | P1 |
| 3 | 迁移与回滚 | 迁移步骤、回滚方案 | P1 |
| 4 | 数据校验 | 校验方法、校验点 | P1 |

### 检查要点

**数据模型**：
- [ ] 表/集合结构是否完整？
- [ ] 字段类型是否明确？
- [ ] 是否考虑了数据量增长？
- [ ] 是否与 HLD 数据模型一致？

**索引设计**：
- [ ] 是否列出所有索引？
- [ ] 索引是否覆盖常用查询？
- [ ] 是否考虑写入性能影响？

**迁移与回滚**：
- [ ] 是否有迁移步骤？
- [ ] 是否有回滚方案？
- [ ] 若无迁移需求，是否明确 N/A 理由？

**数据校验**：
- [ ] 是否有校验方法与校验点？
- [ ] 校验是否可执行？

---

## Async/Event 模块

当 LLD 涉及异步处理或事件驱动时启用。

### 必填章节

| # | 章节 | 必填内容 | 缺失严重度 |
|---|------|----------|-----------|
| 1 | 消息格式定义 | 消息结构、字段说明 | P1 |
| 2 | 消费者设计 | 消费逻辑、并发策略 | P1 |
| 3 | 幂等处理 | 幂等键、去重策略 | P1 |
| 4 | DLQ 策略 | 死信队列处理、告警 | P1 |

### 检查要点

- [ ] 消息格式是否定义清晰？
- [ ] 消费者并发策略是否明确？
- [ ] 幂等键是否定义？
- [ ] 失败重试策略是否明确？
- [ ] DLQ 处理流程是否明确？

---

## Infra/IaC 模块

当 LLD 涉及基础设施或 IaC 变更时启用。

### 必填章节

| # | 章节 | 必填内容 | 缺失严重度 |
|---|------|----------|-----------|
| 1 | 资源定义 | 云资源清单、配置 | P1 |
| 2 | 权限与配置 | IAM/权限、环境变量/配置管理 | P1 |
| 3 | 共享组件复用 | 复用现有模块/基础设施 | P1 |

### 检查要点

- [ ] 是否列出所有需要的云资源？
- [ ] 资源配置是否明确（规格、数量）？
- [ ] IAM/权限是否定义？
- [ ] 环境变量/配置是否列出？
- [ ] 是否复用共享模块（如有）？

---

## Observability 模块

当 LLD 需要可观测性设计时启用。

### 必填章节

| # | 章节 | 必填内容 | 缺失严重度 |
|---|------|----------|-----------|
| 1 | 指标定义 | 业务指标、技术指标 | P1 |
| 2 | 日志规范 | 日志级别、格式、关键日志点 | P1 |
| 3 | 告警规则 | 告警条件、阈值、通知策略 | P1 |
| 4 | Dashboard 设计 | 监控面板布局 | P2 |

### 检查要点

- [ ] 业务指标是否支撑 PRD 成功指标？
- [ ] 技术指标是否覆盖关键路径？
- [ ] 日志是否覆盖关键操作？
- [ ] 告警阈值是否合理？

---

## Security/Compliance 模块

当 LLD 涉及权限、PII 或合规要求时启用。

### 必填章节

| # | 章节 | 必填内容 | 缺失严重度 |
|---|------|----------|-----------|
| 1 | 认证授权 | 认证方式、权限模型 | P1 |
| 2 | 数据保护 | 加密/脱敏/访问控制 | P1 |
| 3 | 审计与合规 | 审计日志、合规要求 | P1 |

### 检查要点

- [ ] 认证/授权是否与 Contract 一致？
- [ ] 敏感数据是否有保护策略？
- [ ] 是否满足合规要求（如有）？

---

## Deployment/Release 模块

当 LLD 涉及发布、灰度或回滚时启用。

### 必填章节

| # | 章节 | 必填内容 | 缺失严重度 |
|---|------|----------|-----------|
| 1 | 发布流程 | CI/CD 或发布步骤 | P1 |
| 2 | 回滚策略 | 回滚条件与步骤 | P1 |
| 3 | Feature Flag | 开关策略与影响范围 | P1 |

### 检查要点

- [ ] 发布步骤是否可执行？
- [ ] 回滚是否可行且具备触发条件？
- [ ] Feature Flag 是否与风险控制一致？

---

## Frontend UX 模块

当 LLD 涉及 UI/前端交互时启用。

### 必填章节

| # | 章节 | 必填内容 | 缺失严重度 |
|---|------|----------|-----------|
| 1 | 路由与状态 | 路由结构、状态管理 | P1 |
| 2 | 交互流程 | 关键交互与流程 | P1 |
| 3 | 异常/空态 | 错误态、空数据态 | P1 |
| 4 | 性能约束 | 首屏/交互性能约束 | P2 |

### 检查要点

- [ ] 路由/状态是否清晰？
- [ ] 关键交互是否可追溯？
- [ ] 错误/空态是否定义？

---

## External Integration 模块

当 LLD 涉及第三方集成时启用。

### 必填章节

| # | 章节 | 必填内容 | 缺失严重度 |
|---|------|----------|-----------|
| 1 | 依赖清单 | 依赖系统/服务列表 | P1 |
| 2 | 认证与限流 | 认证方式、限流策略 | P1 |
| 3 | 重试与降级 | 重试策略、降级方案 | P1 |

### 检查要点

- [ ] 依赖是否列出并有接口说明？
- [ ] 认证/限流是否明确？
- [ ] 重试/降级是否有策略？

---

## SDK/Library 模块

当 LLD 涉及公共库或 SDK 时启用。

### 必填章节

| # | 章节 | 必填内容 | 缺失严重度 |
|---|------|----------|-----------|
| 1 | API 面定义 | 公共 API、签名 | P1 |
| 2 | 版本策略 | 版本号/兼容策略 | P1 |
| 3 | 发布方式 | 发布流程/制品管理 | P2 |

### 检查要点

- [ ] API 面是否完整且稳定？
- [ ] 兼容策略是否明确？

---

## N/A 理由合规标准

当模块标记为 Excluded 时，必须提供合规的 N/A 理由。

### 合规理由示例

| 模块 | 合规 N/A 理由 | 不合规理由 |
|------|--------------|-----------|
| Storage & Migration | 「本功能为纯计算，无数据持久化需求」 | 「暂不需要」 |
| Async/Event | 「所有操作同步完成，无异步场景」 | 「以后再加」 |
| Deployment/Release | 「纯文档/原型，无发布流程」 | 「先不写」 |
| Observability | 「离线工具/不进入生产，无观测需求」 | 「不重要」 |

### N/A 理由检查

- [ ] 理由是否说明了为什么不需要该模块？
- [ ] 理由是否与功能需求一致？
- [ ] 理由是否合理（非敷衍）？
